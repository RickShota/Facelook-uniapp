<template>
	<view>
		<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
		<!-- #ifdef MP-WEIXIN -->
		<uni-nav-bar statusBar fixed="true" backgroundColor="#f0f2f5">
			<template v-slot:left>
				<view class="logo-text">èœå•</view>
			</template>
			<template v-slot:right>
				<view></view>
			</template>
		</uni-nav-bar>
		<!-- #endif -->

		<view class="menuPage">
			<!-- ä¸ªäººä¿¡æ¯æ  -->
			<view class="flex align-center" @click="gotoMy()">
				<image v-if="loginStatus" :src="userImg" class="rounded-circle mr-2"
					style="height: 70rpx;width: 70rpx;">
				</image>
				<image v-else src="/static/default/defUser.png" class="rounded-circle mr-2"
					style="height: 70rpx;width: 70rpx;">
				</image>
				<view class="flex flex-column flex-1">
					<view class="flex align-center justify-between">
						<!-- æ˜µç§° -->
						<text v-if="loginStatus" class="font">{{userInfo.username}}</text>
						<text v-else class="font">ç‚¹å‡»ç™»å½•ï¼Œä½“éªŒæ›´å¤šåŠŸèƒ½</text>
					</view>
					<view class="flex align-center justify-between">
						<text v-show="loginStatus" class="text-secondary text-ellipsis"
							style="width: 500rpx;font-size: 25rpx;">æŸ¥çœ‹ä½ çš„ä¸ªäººä¸»é¡µ</text>
					</view>
				</view>
			</view>

			<!-- åˆ†å‰²çº¿ -->
			<view style="width: 100%;height: 1px;background-color: #dedede; margin: 20rpx 0;"></view>
			<!-- åŠŸèƒ½æŒ‰é’® -->
			<text style="font-size: 26rpx;margin-left: 5rpx;">æ‰€æœ‰å¿«é€Ÿè®¿é—®é¡¹ç›®</text>
			<view class="btns">
				<view hover-class="hoverbtn" @click="gotoFreinds" class="menu-btn">
					<text style="margin-left: 10rpx;">ğŸ‘¥</text><br>
					<text>å¥½å‹</text>
				</view>
				<view hover-class="hoverbtn" @click="gotoSession" class="menu-btn">
					<text style="margin-left: 10rpx;">ğŸ’¬</text><br>
					<text>èŠå¤©</text>
				</view>
				<view hover-class="hoverbtn" @click="gotoTopic" class="menu-btn">
					<text style="margin-left: 10rpx;">#ï¸âƒ£</text><br>
					<text>è¯é¢˜</text>
				</view>
				<view hover-class="hoverbtn" @click="gotoClear" class="menu-btn">
					<text style="margin-left: 10rpx;">ğŸ—‘ï¸</text><br>
					<text>æ¸…é™¤ç¼“å­˜</text>
				</view>
				<view hover-class="hoverbtn" @click="gotoEmpty" class="menu-btn">
					<text style="margin-left: 10rpx;">ğŸ”–</text><br>
					<text>æ”¶è—å¤¹</text>
				</view>
				<view hover-class="hoverbtn" @click="gotoEmpty" class="menu-btn">
					<text style="margin-left: 10rpx;">ğŸ•¹</text><br>
					<text>æ´»åŠ¨</text>
				</view>
			</view>
			<!-- åˆ†å‰²çº¿ -->
			<view style="width: 100%;height: 1px;background-color: #cbced3; margin: 20rpx 0 0 0;"></view>
			<!-- å¸®åŠ©ä¸æ”¯æŒ -->
			<uni-collapse>
				<uni-collapse-item title="å¸®åŠ©ä¸æ”¯æŒ" thumb="/static/default/help.png" show-animation>
					<view class="btns">
						<view hover-class="hoverbtn" @click="gotoEmpty" class="menu-btn">ï¸ï¸
							<text style="margin-left: 10rpx;">ğŸ›Ÿ</text><br>
							<text>å¸®åŠ©ä¸­å¿ƒ</text>
						</view>
						<view hover-class="hoverbtn" @click="gotoEmpty" class="menu-btn">
							<text style="margin-left: 10rpx;">âš ï¸ï¸</text><br>
							<text>æŠ¥å‘Šé—®é¢˜</text>
						</view>
						<view hover-class="hoverbtn" @click="gotoEmpty" class="menu-btn">ï¸ï¸
							<text style="margin-left: 10rpx;">ğŸ›¡</text><br>
							<text>è´¦æˆ·å®‰å…¨</text>
						</view>
						<view hover-class="hoverbtn" @click="gotoEmpty" class="menu-btn">
							<text style="margin-left: 10rpx;">ğŸ“œ</text><br>
							<text>æ¡æ¬¾æ”¿ç­–</text>
						</view>
					</view>
				</uni-collapse-item>
				<!-- è®¾ç½®ä¸éšç§ -->
				<uni-collapse-item title="è®¾ç½®ä¸éšç§" thumb="/static/default/setting.png" show-animation>
					<view class="btns-last">
						<view hover-class="hoverbtn" @click="gotoEmpty">ï¸ï¸
							<text style="margin: 0 10rpx;">âš™ï¸</text>
							<text>é€šç”¨è®¾ç½®</text>
						</view>
						<view hover-class="hoverbtn" @click="gotoEmpty">
							<text style="margin: 0 10rpx;">ğŸ“²</text>
							<text>è®¾å¤‡ç™»å½•è¯·æ±‚</text>
						</view>
						<view hover-class="hoverbtn" @click="gotoEmpty">ï¸ï¸
							<text style="margin: 0 10rpx;">ğŸ¯</text>
							<text>ä¸ªæ€§åŒ–å¹¿å‘Š</text>
						</view>
						<view hover-class="hoverbtn" @click="gotoEmpty">
							<text style="margin: 0 10rpx;">ğŸ—ƒï¸</text>
							<text>ä¸ªäººä¿¡æ¯æ”¶é›†</text>
						</view>
					</view>
				</uni-collapse-item>
			</uni-collapse>
			<!-- é€€å‡ºç™»å½• -->
			<view v-show="loginStatus" class="logout-btn" hover-class="logout-btn-ed" @click="logout">
				é€€&nbsp;å‡º&nbsp;ç™»&nbsp;å½•
			</view>
			<!-- ç‰ˆæƒä¿¡æ¯ -->
			<view class="copyright mt-3">
				<text class="a">copyright@2022&nbsp;|&nbsp;made&nbsp;by&nbsp;é»„ç‘ç‘</text><br>
				<text class="b">è¯¥è½¯ä»¶ä¸ºæ¨¡ä»¿Facebookçš„ç»ƒæ‰‹é¡¹ç›®ï¼Œéå•†ä¸šç”¨é€”</text><br>
				<text class="b">ä½œè€…ä¿ç•™æ‰€æœ‰æƒ</text>
			</view>
		</view>
	</view>

</template>

<script>
	// #ifdef MP-WEIXIN
	import uniNavBar from '@/uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.vue'
	// #endif
	import {mapState} from 'vuex';
	export default {
		components: {
			// #ifdef MP-WEIXIN
			uniNavBar
			// #endif
		},
		data() {
			return {
				isLog: false,
				userImg: '/static/default/userImg.jpg'
			}
		},
		// åŒæ­¥ç™»å½•çŠ¶æ€
		computed:{
			...mapState(['loginStatus','userInfo'])
		},
		onLoad() {
			// è·å–ç™»å½•çŠ¶æ€
			this.$store.dispatch('initUser')
		},
		// ç›‘å¬å¯¼èˆªæ æŒ‰é’®
		onNavigationBarButtonTap(e) {
			switch (e.index) {
				case 0: // æœç´¢
					uni.navigateTo({
						url: '../search/search?type=facelook',
						animationType: 'fade-in'
					});
					break;
				case 1: // è®¾ç½®
					uni.showToast({
						title: 'è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘',
						duration: 2000,
						icon: 'error'
					});
					break;
			}
		},
		methods: {
			
			gotoFreinds() {
				// æƒé™éªŒè¯
				this.checkAuth(() => {
					uni.navigateTo({
						url: '../friends-list/friends-list',
					});
				})
			},
			gotoSession() {
				// æƒé™éªŒè¯
				this.checkAuth(() => {
					uni.navigateTo({
						url: '../session-list/session-list',
					});
				})
			},
			gotoTopic() {
				// è·³è½¬åˆ° tabBar é¡µé¢ï¼Œå¹¶å…³é—­å…¶ä»–æ‰€æœ‰é tabBar é¡µé¢
				uni.switchTab({
					url: '../news/news',
				});
			},
			gotoMy() {
				// æƒé™éªŒè¯
				this.checkAuth(() => {
					uni.switchTab({
						url: '../user/user',
					});
				})
			},
			// æ¸…é™¤ç¼“å­˜
			gotoClear() {
				uni.showModal({
					content: "æ¸…é™¤æœ¬åœ°ç¼“å­˜ä¼šé€€å‡ºç™»å½•ï¼Œç¡®å®šç»§ç»­ï¼Ÿ",
					success: (e) => {
						if (e.confirm) {
							let res = uni.getStorageInfoSync().currentSize
							let rabish = res < 1024 ? res + 'kb' : (res / 1024).toFixed(2) + 'Mb'
							uni.showToast({
								icon: 'success',
								title: `å·²æ¸…é™¤${rabish}ç¼“å­˜`
							})
							uni.clearStorageSync()
						}
					}
				})
			},
			gotoEmpty() {
				uni.showToast({
					title: 'è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘',
					duration: 2000,
					icon: 'error'
				});
			},
			// é€€å‡ºç™»å½•
			logout() {
				uni.showActionSheet({
					title: "ç¡®å®šé€€å‡ºï¼Ÿ",
					itemList: ['é€€å‡º'],
					itemColor: '#c80104',
					success: (res) => {
						if(res.tapIndex===0){
							// è°ƒç”¨vuexé‡Œçš„é€€å‡ºå‡½æ•°
							this.$store.commit('logout')
							uni.showToast({
								title:'é€€å‡ºç™»å½•æˆåŠŸ',
								icon:'none'
							})
						}
					},
				});
			}
		}
	}
</script>

<style lang="less">
	page {
		background-color: #f0f2f5;

		.logo-text {
			font-size: 50rpx;
			font-weight: 500;
			color: #000;
		}

		.menuPage {
			padding: 20rpx;



			.btns {
				margin: 20rpx 0;
				display: flex;
				justify-content: center;
				flex-wrap: wrap;

				.hoverbtn {
					background-color: #c8c8c8;
				}

				.menu-btn {
					background-color: #fff;
					width: 47%;
					height: 120rpx;
					border-radius: 15rpx;
					border: 1rpx solid #e8e8e8;
					box-shadow: 2px 3px 20px 1px #dcdcdc;
					margin: 0 15rpx 15rpx 0;
					padding: 20rpx;
					box-sizing: border-box;
					font-size: 30rpx;
				}
			}

			.btns-last {
				margin: 20rpx 0;
				display: flex;
				justify-content: center;
				flex-wrap: wrap;

				.hoverbtn {
					background-color: #c8c8c8;
				}

				view {
					background-color: #fff;
					width: 95%;
					height: 90rpx;
					border-radius: 15rpx;
					border: 1rpx solid #e8e8e8;
					box-shadow: 2px 3px 20px 1px #dcdcdc;
					margin: 0 15rpx 15rpx 0;
					padding: 20rpx;
					box-sizing: border-box;
					font-size: 30rpx;
				}
			}

			.logout-btn {
				background-color: #dee0e2;
				height: 70rpx;
				margin: 40rpx 20rpx;
				text-align: center;
				line-height: 70rpx;
				border-radius: 5px;
				font-weight: 600;
			}

			.logout-btn-ed {
				background-color: #b7b9ba;
			}

			.copyright {
				text-align: center;

				.a {
					font-size: 25rpx;
					color: #9f9f9f;
				}

				.b {
					font-size: 20rpx;
					color: #bdbdbd;
				}
			}
		}
	}
</style>
